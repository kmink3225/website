---
title: "DevOps Project: Diagnostic Device QC Platform Construction"
subtitle: "Long Term Strategy: Seegene's Full Automation"
description: "Due to security concerns, it is difficult to display the data used in this project."
author: Kwangmin Kim
date: 2023-04-22
format: 
  html:
    toc: true  
    #page-layout: article
    code-fold: true
    code-copy: true
    code-overflow: wrap
    number-sections: true
    number-depth: 3
    grid:
      sidebar-width: 200px
      body-width: 1200px
      margin-width: 100px
---

<ul class="nav nav-pills" id="language-tab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="Korean-tab" data-bs-toggle="tab" data-bs-target="#Korean" type="button" role="tab" aria-controls="Korean" aria-selected="true">Korean</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="English-tab" data-bs-toggle="tab" data-bs-target="#English" type="button" role="tab" aria-controls="knitr" aria-selected="false">English</button>
  </li>

<div class="tab-content" id="language-tabcontent">

<div class="tab-pane fade  show active" id="Korean" role="tabpanel" aria-labelledby="Korean-tab">

## 프로젝트 개요

* PCR 진단 시약을 타사 장비 공급업체의 장비에 넣어 검출 결과를 얻는다. 
* 진단 서비스 결과의 정확도를 위해 **2 Phase 장비 QC 프로세스를 통해 장비의 성능을 평가**한다.
* 프로젝트의 목적: 1. 부정확한 **QC 알고리즘 개선** 2. 투입 리소스가 많은 **QC프로세스 과정을 간소화**시켜 현업의 부담을 경감
* 프로젝트 기간: 9개월
* **Two Step QC Process**
  * Step 1: 자사 시약에 맞게 **신호 Scale Calibration** (소요 시간: 2시간/장비1대, 담당자 1명)
  * Step 2: 장비의 성능을 평가하여 **합격/불합격 분류** (소요 시간: 4시간 ~ 8시간/장비1대, 담당자 1명)
  * 문제점
    * 엑셀을 이용한 **수동검사**, 비효율적인 **데이터 및 장비 추적 관리** 
    * 수동 검사 과정에서 신호의 증폭 크기에 따라 **왜곡된 QC 결과** 발생
    * **기계 결함 및 휴먼 에러 구별 불가**    

```{mermaid}
flowchart LR
    A["QC 장비 입고"] --> B["Step 1 <br> 신호 Scale Calibration<br/> 담당자 1명 & 2시간/장비1대<br/>"]
    B --> C["Step 2 <br> 장비 성능 평가 <br/> 담당자 1명 & 4-8시간/장비1대<br/>"]
    C --> D["합격/불합격 분류<br/> 및 장비 등급 부여"]
    
    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style C fill:#f3e5f5
    style D fill:#e8f5e8
```

## 전략

* Data Engineering을 통해 산재된 Excel 형태의 **QC data를 통합 및 가공하여 분석 가능한 형태로 변환**
* QC Step2의 **장비 성능 평가 지표를 생성**하여 장비 성능 측정 고도화
* **합격/불합격 분류** 뿐만 아니라 **장비 등급을 차등 부여**하여 고객사에 차등 공급 
* 시간에 따른 **장비의 성능을 지속적으로 모니터링**하여 장비의 성능 분석 및 life cycle 관리  
* **QC Process 간소화**
  * Step 1 데이터를 통해 Step 2 결과를 예측하는 딥러닝 모델 개방
  * 예측 결과로 장비성능이 Fail로 확실시 되는 장비에 한해서 Step 2 검사 진행
  * Web App (R Shiny) 로 분석 결과 및 시각화 Dashboard 제공
  * 실무 담당자가 데이터 업로드 하면 자동으로 분석 결과 제공

```{mermaid}
flowchart TD
    A["PCR 진단 시약<br/>타사 장비에 투입"] --> B["Step 1 <br> 신호 Scale Calibration<br/>데이터 수집"]
    B --> C["딥러닝 모델<br/>Step 2 결과 예측"]
    
    C --> D{"예측 결과<br/>Fail 확실?"}
    D -->|Yes| E["Step 2 검사 진행<br/>장비 성능 평가지표 생성"]
    D -->|No| F["Step 2 검사 생략"]
    
    E --> G["장비 등급 차등 부여<br/>A+, A, B, F"]
    F --> H["자동 Pass"]
    
    G --> I["Web App (R Shiny)<br/>분석 결과 & 시각화 Dashboard"]
    H --> I
    
    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style C fill:#fff3e0
    style D fill:#fff3e0
    style E fill:#f3e5f5
    style F fill:#e8f5e8
    style G fill:#e8f5e8
    style H fill:#e8f5e8
    style I fill:#e0f2f1
```

## 결과

* ETL 결과: PCR기기 2201대를 2552번의 실험해서 만들어진 61,248개의 신호 데이터 확보
* QC Process Step 2 장비 성능 평가 메트릭 생성
  * 신호 증폭 효율성 측정
  * SNR (Signal to Noise Ratio) 측정
  * 기준선 안전성 측정
  * 광학 균일성 측정
  * 장비 온도 균일성 측정
  * 음성 신호 추세 측정
  * 양성 신호 노이즈 측정
  * 시계열 분해 기반 노이즈 측정
  * Outlier 및 Anomaly Data 탐지로 labeling (IQR. Z score, PCA, t-SNE, DBSCAN, 3-Sigma Rule, Isolation Forest)
  * 신호 RSS (Residual Sum of Squares) 측정
* 평가 메트릭 기반 합격/불합격 장비 분류, 장비 성능 4등급 부여
  * Pass (A,B,C), Fail (F)
* BiLSTM을 활용한 Step 1 데이터를 통한 Step 2 결과 예측 모델 개방 
  * 합격/불합격 분류 정확도: 99.3%
  * 장비 성능 등급 분류 정확도: 97.3%
  * 장비별 클러스터링
  <이미지>
* 웹 기반 자동화 플랫폼 제공
  * 실무자가 데이터 업로드 하면 자동으로 분석 결과 제공
  * 시각화 및 데이터 관리 기능 제공
* 연간 처리 시간 782배 이상 단축
* 연간 비용 약 13배 감소
* 총괄장 R&D 부문 우수상 수상
* 2개의 특허 발명을 출원


</div>

<div class="tab-pane fade" id="English" role="tabpanel" aria-labelledby="English-tab">

## Background

* Quality Control of diagnostic equipment is one of the necessities for the regulations required by the government of each country when entering the global market due to the nature of products related to medical equipment.
    * Reagent stability verification & validation required
    * **Equipment stability verification & validation request**
    * Software stability verification & validation request
    * Stability Verification & validation Request of Diagnostic Algorithm
* Since the diagnostic equipment currently being used by Seegene is not its own product, it is difficult to manage the quality of the diagnostic equipment.
* The noise test of PCR equipment is one of the QC processes of medical equipments, and it is a quality verification system that directly affects the performance stability of Seegene's reagent products.
* As the size of the company grows and frequent organizational reshuffles result in manual noise tests being transferred to various departments, the noise test performers' understanding and skills are low, resulting in noise tests not being performed correctly.
* A project to automate the noise test was selected for Seegene's long-term goal of enterprise automation.
 
## Objective

* Data-driven parameters obtained from 61,248 signals from 2552 experiments were used to evaluate 2201 PCR devices, which were stocked between 2020.12.19 and 2021.03.06. yield Enables continuous analysis of equipment performance over time.
* Improve the following major problems:
    * Improved metrics that produces erroneous results by greatly affecting the noise test result depending on the size of the signal amplification. 
    * It relieves the burden on the field department with a robust evaluation system by supplementing the problem of unconditionally determining equipment rejection in response to a simple human error signal.
    * Equipment error signals are labeled by finding patterns that occur in equipment.
* The time required for the manual calculation process can be reduced from 30 minutes per 20 tests to about 2 to 3 minutes with web-based automation.
* By making this project the best practice example of Seegene's full automation, establish and vitalize the cooperation system between the IT, manufacturing and BT sectors.
* Visualization and noise test result history are provided to build a tracking and VOC response system.

## Strategies

### Strategy A

* The QC process is subdivided through close communication with the field departments, and the results of the noise test, which is the next stage QC, are predicted by utilizing the data generated in the previous stage QC.
* Noise test omitted only for devices that are certain to have low noise.

### Strategy B

* Automate or semi-automate the entire QC process
* Improve the accuracy of inspection results by analyzing the existing noise measurement metric and creating a new metric
* Visualization and noise test result history are provided to increase the understanding of practitioners and enable management

## Issues

* Absence of job description
* Backup Mistakes by Practitioners
* Data scattered across departments
* High level of data cleansing
    * Select data that can be analyzed from practitioner data
    * Incorrect input of practitioner data
    * Manual release of DRM for data and documents
* reverse engineering required
* Absence of contact system for related personnel and departments due to frequent organizational reshuffle

## Required Skills

* Back-end Engineering for DevOps Pipeline Construction
* Data Engineering for data cleansing and reverse engineering
* Data Modeling for a RDB system construction
* Statistical Analysis for the noise test performance verification
* Machine Learning for pattern analysis
* Front-end Engineering for UI/UX construction
* Biologics, Biophysics, Physics Knowledge

## Colaborators

* 1 data scientist (me) - project owner
* 5 mechanical engineers 
* 4 biologists
* 2 patent attorneys
* 2 data engineers
* 3 full stack developers
* 1 advisor (a professor of Computer Science at Seoul National University)
 
## Acheivements

|Noise Test| As-Is |To-Be |
|:---:|:---|:---|
| Sample Size Used for QC Algorithm Development  | n=100  | Signals from 2552 experiments, n=61,248   |
| Sample Size Used for QC Algorithm Performance Comparison | n=61,248  | n=61,248   |
| Evaluation Metrics | 2 metrics | 10 metrics ( the exsting 2 metrics + new 8 metrics)   |
| Input Process | manually copy & paste data of excel files extracted from a certain program | Web-Based Automation, upload multiple experiment files |
| Output Process| Batch Evaluation method, if even one of the signals from the equipment fails, the equipment fails. (Blind Spot: If there is one human error signal, the equipment is unconditionally disqualified.)| Differential Evaluation method, The signals from the equipment are scored, the average value is obtained, and the equipment is graded A+, A, B, and F. Failed if F. Robust on error signals as it excludes the error signal from evaluation.  |
| Output 1 |  pass: 92.58%, fail: 7.42% (after excluding many human errors) | A+ (pass): 7.01%, A (pass): 12.91%, B (pass): 75.72%, F (fail): 4.36%  |
| Output 2 |  NA | Visualized Plots and Tables.|
| Output 3 |  NA | Classfication Results: Normal Signals, Human Errors, Device Errors, Manufacturing Errors |
| Time Consumed  | About 30 minutes per 20 experiments | About 25 minutes per 2552 experiments  |
| Data Management| Non-standard management method (stored in NAS directory in a different form as an Excel file in a different way for each worker) | Automatic loading in DB in standardized form by a scheduler (it is possible to conduct an equipment failure tracing analysis) |

### Remarkable

* During the data analysis and understanding process, it was confirmed that contrary to practitioners' speculation, the performance of the equipment showed overall consistency.
* An algorithm to filter out devices that generate fatal signals like significant noise was added.
* At a 1% significance level, it was statistically proven that the results of the noise tests do not significantly affect the average difference in the final outcomes of the entire diagnostic process, leading to **the elimination of noise tests from the total QC process**. 
  * Paired t-tests and chi-squared tests were utilized for this purpose.
* The data science department had the opportunity to enhance their understanding of experiments and data generated from equipment.
* This became the foundation for the construction of a company-wide database and the development of platform architecture.
</div>