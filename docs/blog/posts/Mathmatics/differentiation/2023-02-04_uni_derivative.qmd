---
title: Differentiation
subtitle: Univariable Differentiation
description: |
  To solve optimization problems, it is required to know about derivatives because derivatives are mostly used 최적화 문제를 풀기위해 미분이 항상 사용되기 떄문에 미분에 대해서 알 필요가 있다. 
categories:
  - Mathematics
author: Kwangmin Kim
date: 02/04/2023
format: 
  html:
    page-layout: full
    code-fold: true
draft: False
---

<ul class="nav nav-pills" id="language-tab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="Korean-tab" data-bs-toggle="tab" data-bs-target="#Korean" type="button" role="tab" aria-controls="Korean" aria-selected="true">Korean</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="English-tab" data-bs-toggle="tab" data-bs-target="#English" type="button" role="tab" aria-controls="knitr" aria-selected="false">English</button>
  </li>

<div class="tab-content" id="language-tabcontent">

<div class="tab-pane fade  show active" id="Korean" role="tabpanel" aria-labelledby="Korean-tab">

## Overview

미분은 최적화 문제를 푼다는 의미는 목적함수를 최적화한다는 말이고 그 과정에서 대부분의 경우 미분을 사용하여 상황에 맞게 목적함수의 극소값이나 극대값을 구하게 된다. 예를 들어, 목적 함수 $f(x;w)$ 가 매개변수 또는 가중치 $w$ 에 의해 그 모양이 결정되므로 $f(x;w)$ 를 최소화하는 최적화 문제를 풀고 싶을 때 $f(x;w)$ 를 cost function (=$f(x;w)$ 의 함수) 또는 loss function (=$f(x;w)$ 의 함수) 으로 잘 정의를 한 후 cost function 또는 loss function을 최소화하는 매개변수 $w$ 를 구해야한다.
대부분의 경우, Machine Learning (Deep Learning 포함) 에서 미분은 error를 줄이기 위해 사용한다.

목적 함수 $f(x;w)$ 가 정의 됐을 때 목적 함수의 극 값을 구하기 위해서 변화량을 관찰해야 한다. 비단 목적함수를 포함한 어떤 현상을 함수로 표현할 때에도 문제를 해결하기 위해 변화량을 관찰하는 경우가 빈번하다.

예를 들어, 선풍기 바람의 세기를 조절할 때 입력값은 바람 세기 버튼 출력값은 바람의 세기로 가정한다면 선풍기 바람 세기 입력에 따라 적절한 출력값을 갖도록 조정하고 싶을 것이다. 이때 변화량 관찰이 요구된다. 변화량을 잘 대변하는 것이 함수의 기울기이다. 함수의 기울기는 민감도 (sensitivity)로 표현되기도 한다(wiki). 기울기는 아래와 같이 정의된다.

## 일 변수 함수의 미분

::: {#def-Slope}

The slope of line connected with the two points $P_1(x_1,y_1) and P_2(x_2,y_2)$ is
$$
m=\frac{y_2-y_1}{x_2-x_1}
$$

:::

::: {#thm-PointSlope}

The point slope equation of line through $P_1(x_1,y_1)$ with slope $m$ is
$$
y-y_1=m(x-x_1)
$$

:::

::: {#thm-SlopeIntercept}

The slope intercept euation of line with slope m and y-intercept b is
$$
y=mx+b
$$

:::

$$
\begin{aligned}
\text{기울기}(slope)&=\frac{\text{출력의 변화량}}{\text{입력의 변화량}}\\ 
&= \text{입력 변화량에 대한 출력 변화량} \\
&=\frac{\Delta output}{\Delta input}\\
&= \text{단위 입력당 출력의 변화량}\\ 
&= \text{민감도, 평균 변화율 (Rates Of Change), or etc}.\\
\end{aligned}
$$


::: {#def-평균변화율}


$$
\begin{aligned}
\text{평균 변화율}&=\Delta x\text{에 대한} \Delta y\text{의 비율}\\
&=\frac{\Delta y}{\Delta x}=\frac{f(b)-f(a)}{b-a}\\
&=\frac{f(a+\Delta x)-f(a)}{\Delta x}
\end{aligned}
$$


:::

* 입력에 대한 변화율을 조절하고 싶을 때 필요한 개념 
  * ex) 시약 농도 대비 신호 증폭의 변화율을 관찰
* 하지만 관심의 대상의 관계 그래프가 직선이 아닌 **곡선의 형태**의 경우 평균 변화율이 대략적인 추세 정보만 제공해줄뿐 변화량의 자세한 정보를 제공해주지 못함
  * sigmoid 형태의 경우 첫 포인트와 마지막 포인트의 평균 변화율을 보는 것 보다 구간을 짧게하여 여러 군데서 관찰하는 것이 graph의 shape를 더 잘 설명하는 것
* 이 때, 입력값의 구간을 **충분히** 짧게 만들어 출력값의 변화량을 관찰하는 것이 미분이다. (limit의 개념, $\epsilon-\delta$ method)

::: {#def-TangentLine}

The tangent line to the curve $y=f(x)$ at the point $P(a,f(a))$ is the line through P with slope

$$
m = \lim_{x\to a} f(x)
$$

provided that this limit exists.
:::



::: {#def-Derivative}

When $f: \mathbb{R} \rightarrow \mathbb{R}$ is continuous and differentiable, the derivative of a function $f$ at a number $a \in \mathbb R$, denoted by $f'(a)$, is

$$
\begin{aligned}
f'(a) &= \lim_{h\to 0} \frac{f(a+h)-f(a)}{h}
      &= \lim_{x\to a} \frac{f(x)-f(a)}{x-a}
\end{aligned}
$$

provided that this limit exists. 이때 위의 함수의 극한값, $f'(a)$ 라고도 표시하며 점 $a$ 에서의 $f(x)$ 의 도함수 (derivative) 라고 한다. 
:::

![James Stewart - Calculus Early Transcedentals, 7th Eidition, P.143](derivative.PNG)

::: {#def-Differentiable}
A function $f$ is differentiable at $a$ if $f'(a)$ exists. It is differentiable on an open interval (a,b) [or (a,$\infty$), (-$\infty$,a) or (-$\infty$,$\infty$)] if it is differentiable at every number in the interval.
:::

::: {#thm-Continuous}
If $f$ is differentiable at $a$, then $f$ is continuous at $a$.
:::

* 순간 변화율 = 미분 계수 = 접선의 기울기
* 미분 (differentiation) : 순간 변화율 구하는 행위
* 도함수 (derivative) : 도함수 자체는 equation 으로, 특정 포인트에서의 순간 변화율 (값)을 출력하는 함수
* 문제를 풀때 도함수를 구하는 것인지, 미분계수를 계산하는 것인지를 구별해야함
* 전체 도함수를 구하는것은 보통 굉장히 어려움. 하지만 한점에서의 순간변화율 즉, 미분계수를 구하는 것은 가능
* 에러를 줄이는 데에는 값으로 나오는 순간 변화율을 구하는 것이 일반적으로 실현성이 있는 문제

::: {#def-NaturalNumber}
The natural number, $e$ is the number such that $\lim_{h\to 0} \frac{e^h-1}{h}=1$.
:::

모든 지수 함수 $f(x)=a^x$ 중에서 $f(x)=e^x$ 가 점 (0.1) 에서의 접선의 기울기가 $f'(0)=1$ 이 되는 수를 $e=2.71828...$ 라고 정의한다.

### Notation

$f'(x)$ 는 다음과 같은 기호들로도 흔히 표현된다.

* Lagrange’s notation
  * $y', f'(x)$
  * 어떤 변수로 미분하는지에 대해서 명시적으로 표현되지 않았음. 고등학교때까진 univariable function을 미분 했기떄문에 이 표기법이 많이 사용되었음.
* Leibniz’s notation
  * $\frac{dy}{dx}=\frac{df}{dx}=\frac{d}{dx}f(x)$
  * 입력 변수와 출력 변수까지 모두 명시되어있음
* Newton’s notation: 
  * $\dot{y}, \ddot{y}$
  * 최적화 논문과 financial engineering 에서 본적 있음
* Euler’s notation
  * $D_xy, D_xf(x)$
  * 시계열 논문과 미분방정식 논문에서 본적 있음

### Example

다음의 함수를 미분의 정의를 이용하여 도함수를 계산하시오

1. $f(x)=c$ where c is a constant
1. $f(x)=\log x$
1. $f(x)=e^x$
1. $f(x)=\sin x$

[Derivative Formula](https://byjus.com/calculus-formulas/)는 모두 미분의 정의를 이용해서 구할 수 있음

::: {#thm-Differentiation_Rules}
1. **The Power Rule**, if $n$ is any real number, then the power function, $x^n$ is differentiated like the following:
$$
\frac{d}{dx}(x^n)=nx^{n-1}
$$

1. **The Constant Multiple Rule**, if $c$ is a constand and $f$ is a differentiable function, then
$$
\frac{d}{dx}(cf'(x))=c\frac{d}{dx}f(x)=cf'(x)
$$

1. **The Sum Rule**, if $f$ and $g$ are both differentiable, then
$$
\frac{d}{dx}[f(x)+g(x)]=\frac{d}{dx}[f(x)]+\frac{d}{dx}[g(x)]=f'(x) +g'(x)
$$

1. **The Difference Rule**, if $f$ and $g$ are both differentiable, then
$$
\frac{d}{dx}[f(x)-g(x)]=\frac{d}{dx}[f(x)]-\frac{d}{dx}[g(x)]=f'(x) -g'(x)
$$

1. **The Product Rule**, if $f$ and $g$ are both differentiable, then
$$
y=f(x)g(x), y'=f'(x)g(x)+f(x)g'(x)
$$

1. **The quotient rule**, if $f$ and $g$ are both differentiable, then
$$
y=\frac{f(x)}{g(x)}, y'=\frac{f'(x)g(x)-f(x)g'(x)}{g(x)^2}
$$
:::

증명은 James Stewart의 Calculus Series 중 1개를 골라 참고하시기 바랍니다.

### Example

1. $S(x)=\frac{1}{1+e^{-ax}}$ 를 $x$ 에 대해 미분해보시오.
1. $f(x)=\alpha_1 + \frac{\alpha_2-\alpha_1}{1+10^{-\alpha_4(x-\alpha_3)}}$ 를 어떻게 미분할 것인지 생각해 보시오.
1. $y=f(x)=(4x+3)^2$ 를  $x$ 에 대해 미분해보시오
1. $y=f(x)=(4x+3)^{20}$ 를 $x$ 에 대해 어떻게 미분할 것인지 생각해보시오. (hint: composite function - Leibniz)

### 미분의 종류

* 직접 미분
  * 이번 블로그에서 정리한 내용
  * 수동 미분: 식을 알고 손으로 미분하여 도함수를 얻음
  * 함수 복잡하면 풀기 매우 어려움
* 간접 미분 
  * 수치 미분: 도함수를 몰라도 미분계수를 구하는데 사용
  * 함수 복잡하면 시간 오래 걸림
* 자동 미분
  * 복잡한 함수를 간단한 함수로 쪼개어 직접 미분 - Pytorch
  * 정합성 검사를 위해 자동 미분의 결과를 간접 미분의 결과와 맞춘다.
  * 간접 미분이 정답이 된다.

### Example Answer

```{python}
import numpy as np
import matplotlib.pyplot as plt
import sympy as S

# 심볼 정의
x=S.Symbol('x')
h=S.Symbol('h')
n=S.Symbol('n')
a=S.Symbol('a')
```

* $f(x)=c$ where c is a constant
```{python}
f=2
df=S.limit(((2)-2)/h,h,0)
print('f=',f,', df=', S.simplify(df))
```
* $f(x)=\log x$
```{python}
f=S.log(x)
df=S.limit((S.log(x+h)-S.log(x))/h,h,0)
print('f=',f,', df=', S.simplify(df))
```
* $f(x)=e^x$
```{python}
f=S.exp(x)
df=S.limit((S.exp(x+h)-S.exp(x))/h,h,0)
print('f=',f,', df=', S.simplify(df))
```
* $f(x)=\sin x$
```{python}
f=S.sin(x)
df=S.limit((S.sin(x+h)-S.sin(x))/h,h,0)
print('f=',f,', df=', S.simplify(df))
```
* $S(x)=\frac{1}{1+e^{-ax}}$ 를 $x$ 에 대해 미분해보시오.
```{python}
f=1/(1+S.exp(-a*x))
df=S.limit((1/(1+S.exp(-a*(x+h)))-1/(1+S.exp(-a*x)))/h,h,0)
print('f=',f,', df=', S.simplify(df))
```
* $f(x)=\alpha_1 + \frac{\alpha_2-\alpha_1}{1+10^{-\alpha_4(x-\alpha_3)}}$ 를 어떻게 미분할 것인지 생각해 보시오.
* $y=f(x)=(4x+3)^2$ 를  $x$ 에 대해 미분해보시오
* $y=f(x)=(4x+3)^{20}$ 를 $x$ 에 대해 어떻게 미분할 것인지 생각해보시오. (hint: composite function - Leibniz)

```{python}
#| echo: false
#| eval: false

import numpy as np
import matplotlib.pyplot as plt
import sympy as S

# 심볼 정의
x=S.Symbol('x')
# 간단한 인수분해로 sympy 사용법을 익히고
S.factor(x**2+2*x-3)
# 함수의 미분 실험
h=S.Symbol('h')
f=2**x
df=S.limit((2**(x+h)-2**x)/h,h,0)
df
# 함수값
f.subs({x:10})
# 도함수 값
df.subs({x:10}).evalf()

# 다항함수
n=S.Symbol('n')
S.simplify(S.limit(((x+h)**n-x**n)/h,h,0))


# 지수함수1
S.simplify(S.limit((S.E**(x+h)-S.E**x)/h,h,0))

# 지수함수2
a=S.Symbol('a')
S.simplify(S.limit((a**(x+h)-a**x)/h,h,0))


# 로그함수 1
S.simplify(S.limit((S.log(x+h)-S.log(x))/h,h,0))

# 로그함수 2
S.simplify(S.limit((S.log(x+h,a)-S.log(x,a))/h,h,0))

print(S.diff(S.E**S.sin(2*x+3)))
# chain rule
z=S.Symbol('z')
out3=S.diff(S.E**z,z)
out2=S.diff(S.sin(z),z)
out1=S.diff(2*x+3)
dz=out3*out2
dw=out2*out1
print(dz)
print(dw)
dz=out3*dw
print(dz)
# substitution
dz.subs({z:3*x+1})


# 바로 미분
S.diff(S.E**(3*x+1), x)

# 연쇄법칙 사용

# z 치환
df.subs({z:3*x+1})

def f(x):
    return (x**2 + 2*x)*np.log(x)

S.simplify( S.diff((x**2 + 2*x)*S.log(x), x) )

def df(x):
    return 2*(x+1)*np.log(x) + (x+2)
```
</div>

<div class="tab-pane fade" id="English" role="tabpanel" aria-labelledby="English-tab">



</div>

## Blog Guide Map Link

* [Statistics Blog](../../statistics/guide_map/index.qmd)
* [Engineering Blog](../../Engineering/guide_map/index.qmd)
* [Deep Learning Blog](../../DL/guide_map/index.qmd)
* [Machine Learning Blog](../../ML/guide_map/index.qmd)
* [Mathematics Blog](../Mathmatics/guide_map/index.qmd)
* [Patent Blog](../../Patent/guide_map/index.qmd)
* [Validation Blog](../../Validation/guide_map/index.qmd)