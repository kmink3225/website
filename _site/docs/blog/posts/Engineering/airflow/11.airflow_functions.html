<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kwangmin Kim">
<meta name="dcterms.date" content="2023-05-01">
<meta name="description" content="template">

<title>Kwangmin Kim - Template Variabler</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../../.././images/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Kwangmin Kim</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../docs/CV/index.html" rel="" target="">
 <span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../docs/projects/index.html" rel="" target="">
 <span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../docs/blog/index.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../../about.html" rel="" target="">
 <span class="menu-text">Me</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/kmink3225" rel="" target=""><i class="bi bi-github" role="img" aria-label="Github">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/kwangmin-kim-a5241b200/" rel="" target=""><i class="bi bi-linkedin" role="img" aria-label="Linkedin">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../docs/blog/index.html" rel="" target=""><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#go-to-blog-content-list" id="toc-go-to-blog-content-list" class="nav-link active" data-scroll-target="#go-to-blog-content-list"><span class="header-section-number">7</span> Go to Blog Content List</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Template Variabler</h1>
<p class="subtitle lead">DAG Creation, Bash Operator, Task Performance Subject,</p>
  <div class="quarto-categories">
    <div class="quarto-category">Engineering</div>
  </div>
  </div>

<div>
  <div class="description">
    <p>template</p>
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Kwangmin Kim </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 1, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<ul class="nav nav-pills" id="language-tab" role="tablist">
<li class="nav-item" role="presentation">
<button class="nav-link active" id="Korean-tab" data-bs-toggle="tab" data-bs-target="#Korean" type="button" role="tab" aria-controls="Korean" aria-selected="true">
Korean
</button>
</li>
<li class="nav-item" role="presentation">
<button class="nav-link" id="English-tab" data-bs-toggle="tab" data-bs-target="#English" type="button" role="tab" aria-controls="knitr" aria-selected="false">
English
</button>
</li>
<div class="tab-content" id="language-tabcontent">

<div id="Korean" class="tab-pane fade show active" role="tabpanel" aria-labelledby="Korean-tab">
<section id="dataset을-이용한-dag-트리거" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Dataset을 이용한 Dag 트리거</h1>
<section id="dataset의-필요성" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="dataset의-필요성"><span class="header-section-number">1.1</span> Dataset의 필요성</h2>
<ul>
<li>case 1</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 184.00 186.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 182)">
<title>
G
</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-182 180,-182 180,4 -4,4"></polygon> <g id="clust1" class="cluster">
<title>
cluster0
</title>
<polygon fill="none" stroke="black" points="8,-8 8,-85 168,-85 168,-8 8,-8"></polygon> <text text-anchor="middle" x="88" y="-68.4" font-family="Times,serif" font-size="14.00">DAG A</text> </g> <g id="clust2" class="cluster">
<title>
cluster1
</title>
<polygon fill="none" stroke="black" points="8,-93 8,-170 78,-170 78,-93 8,-93"></polygon> <text text-anchor="middle" x="43" y="-153.4" font-family="Times,serif" font-size="14.00">DAG B</text> </g> <!-- task_1 --> <g id="node1" class="node">
<title>
task_1
</title>
<polygon fill="none" stroke="black" points="70,-52 16,-52 16,-16 70,-16 70,-52"></polygon> <text text-anchor="middle" x="43" y="-29.8" font-family="Times,serif" font-size="14.00">task_1</text> </g> <!-- task_3 --> <g id="node2" class="node">
<title>
task_3
</title>
<polygon fill="none" stroke="black" points="160,-52 106,-52 106,-16 160,-16 160,-52"></polygon> <text text-anchor="middle" x="133" y="-29.8" font-family="Times,serif" font-size="14.00">task_3</text> </g> <!-- task_1&#45;&gt;task_3 --> <g id="edge1" class="edge">
<title>
task_1-&gt;task_3
</title>
<path fill="none" stroke="black" d="M70.4,-34C78.39,-34 87.31,-34 95.82,-34"></path> <polygon fill="black" stroke="black" points="95.92,-37.5 105.92,-34 95.92,-30.5 95.92,-37.5"></polygon> </g> <!-- task_k --> <g id="node3" class="node">
<title>
task_k
</title>
<polygon fill="none" stroke="black" points="70,-137 16,-137 16,-101 70,-101 70,-137"></polygon> <text text-anchor="middle" x="43" y="-114.8" font-family="Times,serif" font-size="14.00">task_k</text> </g> </g>
</svg>
</div>
</div>
</div>
</div>
<ul>
<li>위의 경우를 Task_1 뿐만 아니라 DAG_B의 task_k 에도 선행 의존관계가 걸리도록 External Task 센서를 하나 달도록 개선</li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 269.66 325.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 321)">
<title>
G
</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-321 265.66,-321 265.66,4 -4,4"></polygon> <g id="clust3" class="cluster">
<title>
cluster2
</title>
<polygon fill="none" stroke="black" points="183.66,-8 183.66,-85 253.66,-85 253.66,-8 183.66,-8"></polygon> <text text-anchor="middle" x="218.66" y="-68.4" font-family="Times,serif" font-size="14.00">DAG B</text> </g> <g id="clust1" class="cluster">
<title>
cluster0
</title>
<polygon fill="none" stroke="black" points="183.66,-93 183.66,-170 253.66,-170 253.66,-93 183.66,-93"></polygon> <text text-anchor="middle" x="218.66" y="-153.4" font-family="Times,serif" font-size="14.00">DAG A</text> </g> <g id="clust2" class="cluster">
<title>
cluster1
</title>
<polygon fill="none" stroke="black" points="8,-178 8,-309 253.66,-309 253.66,-178 8,-178"></polygon> <text text-anchor="middle" x="130.83" y="-292.4" font-family="Times,serif" font-size="14.00">DAG C</text> </g> <!-- task_1 --> <g id="node1" class="node">
<title>
task_1
</title>
<polygon fill="none" stroke="black" points="245.66,-137 191.66,-137 191.66,-101 245.66,-101 245.66,-137"></polygon> <text text-anchor="middle" x="218.66" y="-114.8" font-family="Times,serif" font-size="14.00">task_1</text> </g> <!-- Sensor_task_1 --> <g id="node2" class="node">
<title>
Sensor_task_1
</title>
<polygon fill="none" stroke="black" points="113.49,-276 16.17,-276 16.17,-240 113.49,-240 113.49,-276"></polygon> <text text-anchor="middle" x="64.83" y="-253.8" font-family="Times,serif" font-size="14.00">Sensor_task_1</text> </g> <!-- Sensor_task_1&#45;&gt;task_1 --> <g id="edge3" class="edge">
<title>
Sensor_task_1-&gt;task_1
</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M100.88,-239.9C105.32,-237.12 109.69,-234.13 113.66,-231 146.08,-205.41 177.52,-169.54 197.19,-145.34"></path> <polygon fill="black" stroke="black" points="200.11,-147.3 203.64,-137.31 194.65,-142.92 200.11,-147.3"></polygon> <text text-anchor="middle" x="152.66" y="-218.2" font-family="Times,serif" font-size="14.00">sensing</text> </g> <!-- task_x --> <g id="node4" class="node">
<title>
task_x
</title>
<polygon fill="none" stroke="black" points="245.66,-249 191.66,-249 191.66,-213 245.66,-213 245.66,-249"></polygon> <text text-anchor="middle" x="218.66" y="-226.8" font-family="Times,serif" font-size="14.00">task_x</text> </g> <!-- Sensor_task_1&#45;&gt;task_x --> <g id="edge1" class="edge">
<title>
Sensor_task_1-&gt;task_x
</title>
<path fill="none" stroke="black" d="M113.87,-249.46C135.77,-245.56 161.26,-241.03 181.5,-237.43"></path> <polygon fill="black" stroke="black" points="182.33,-240.84 191.56,-235.64 181.1,-233.95 182.33,-240.84"></polygon> </g> <!-- Sensor_task_2 --> <g id="node3" class="node">
<title>
Sensor_task_2
</title>
<polygon fill="none" stroke="black" points="113.49,-222 16.17,-222 16.17,-186 113.49,-186 113.49,-222"></polygon> <text text-anchor="middle" x="64.83" y="-199.8" font-family="Times,serif" font-size="14.00">Sensor_task_2</text> </g> <!-- Sensor_task_2&#45;&gt;task_x --> <g id="edge2" class="edge">
<title>
Sensor_task_2-&gt;task_x
</title>
<path fill="none" stroke="black" d="M113.87,-212.54C135.77,-216.44 161.26,-220.97 181.5,-224.57"></path> <polygon fill="black" stroke="black" points="181.1,-228.05 191.56,-226.36 182.33,-221.16 181.1,-228.05"></polygon> </g> <!-- task_k --> <g id="node5" class="node">
<title>
task_k
</title>
<polygon fill="none" stroke="black" points="245.66,-52 191.66,-52 191.66,-16 245.66,-16 245.66,-52"></polygon> <text text-anchor="middle" x="218.66" y="-29.8" font-family="Times,serif" font-size="14.00">task_k</text> </g> <!-- Sensor_task_2&#45;&gt;task_k --> <g id="edge4" class="edge">
<title>
Sensor_task_2-&gt;task_k
</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M82.08,-185.81C109.13,-155.52 163.5,-94.64 194.54,-59.89"></path> <polygon fill="black" stroke="black" points="197.48,-61.85 201.53,-52.06 192.26,-57.19 197.48,-61.85"></polygon> <text text-anchor="middle" x="152.66" y="-133.2" font-family="Times,serif" font-size="14.00">sensing</text> </g> </g>
</svg>
</div>
</div>
</div>
</div>
</div>
</div>
<ul>
<li>case 2</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 184.00 155.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 151)">
<title>
G
</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-151 180,-151 180,4 -4,4"></polygon> <g id="clust1" class="cluster">
<title>
cluster0
</title>
<polygon fill="none" stroke="black" points="8,-8 8,-139 168,-139 168,-8 8,-8"></polygon> <text text-anchor="middle" x="88" y="-122.4" font-family="Times,serif" font-size="14.00">DAG A</text> </g> <!-- task_1 --> <g id="node1" class="node">
<title>
task_1
</title>
<polygon fill="none" stroke="black" points="70,-106 16,-106 16,-70 70,-70 70,-106"></polygon> <text text-anchor="middle" x="43" y="-83.8" font-family="Times,serif" font-size="14.00">task_1</text> </g> <!-- task_3 --> <g id="node2" class="node">
<title>
task_3
</title>
<polygon fill="none" stroke="black" points="160,-106 106,-106 106,-70 160,-70 160,-106"></polygon> <text text-anchor="middle" x="133" y="-83.8" font-family="Times,serif" font-size="14.00">task_3</text> </g> <!-- task_1&#45;&gt;task_3 --> <g id="edge1" class="edge">
<title>
task_1-&gt;task_3
</title>
<path fill="none" stroke="black" d="M70.4,-88C78.39,-88 87.31,-88 95.82,-88"></path> <polygon fill="black" stroke="black" points="95.92,-91.5 105.92,-88 95.92,-84.5 95.92,-91.5"></polygon> </g> <!-- task_4 --> <g id="node3" class="node">
<title>
task_4
</title>
<polygon fill="none" stroke="black" points="70,-52 16,-52 16,-16 70,-16 70,-52"></polygon> <text text-anchor="middle" x="43" y="-29.8" font-family="Times,serif" font-size="14.00">task_4</text> </g> </g>
</svg>
</div>
</div>
</div>
</div>
<ul>
<li>위의 경우, Task_1이 완료되면 또 다른 dag 을 trigger 되고 싶은데 DAG A 를 수정해야할 경우</li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 184.00 155.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 151)">
<title>
G
</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-151 180,-151 180,4 -4,4"></polygon> <g id="clust1" class="cluster">
<title>
cluster
</title>
<polygon fill="none" stroke="black" points="8,-8 8,-139 168,-139 168,-8 8,-8"></polygon> <text text-anchor="middle" x="88" y="-122.4" font-family="Times,serif" font-size="14.00">DAG A</text> </g> <!-- task_1 --> <g id="node1" class="node">
<title>
task_1
</title>
<polygon fill="none" stroke="black" points="70,-79 16,-79 16,-43 70,-43 70,-79"></polygon> <text text-anchor="middle" x="43" y="-56.8" font-family="Times,serif" font-size="14.00">task_1</text> </g> <!-- task_3 --> <g id="node2" class="node">
<title>
task_3
</title>
<polygon fill="none" stroke="black" points="160,-52 106,-52 106,-16 160,-16 160,-52"></polygon> <text text-anchor="middle" x="133" y="-29.8" font-family="Times,serif" font-size="14.00">task_3</text> </g> <!-- task_1&#45;&gt;task_3 --> <g id="edge1" class="edge">
<title>
task_1-&gt;task_3
</title>
<path fill="none" stroke="black" d="M70.4,-52.9C78.48,-50.42 87.51,-47.65 96.1,-45.01"></path> <polygon fill="black" stroke="black" points="97.39,-48.28 105.92,-42 95.33,-41.59 97.39,-48.28"></polygon> </g> <!-- task_4 --> <g id="node3" class="node">
<title>
task_4
</title>
<polygon fill="none" stroke="black" points="160,-106 106,-106 106,-70 160,-70 160,-106"></polygon> <text text-anchor="middle" x="133" y="-83.8" font-family="Times,serif" font-size="14.00">task_4</text> </g> <!-- task_1&#45;&gt;task_4 --> <g id="edge2" class="edge">
<title>
task_1-&gt;task_4
</title>
<path fill="none" stroke="black" d="M70.4,-69.1C78.48,-71.58 87.51,-74.35 96.1,-76.99"></path> <polygon fill="black" stroke="black" points="95.33,-80.41 105.92,-80 97.39,-73.72 95.33,-80.41"></polygon> </g> </g>
</svg>
</div>
</div>
</div>
</div>
</div>
</div>
<ul>
<li>TriggerDagRun 오퍼레이터와 ExternalTask 센서를 많이 사용하다보면 연결관리 에 많은 노력이 필요 (강한 연결)</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 301.55 209.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 205)">
<title>
G
</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-205 297.55,-205 297.55,4 -4,4"></polygon> <g id="clust1" class="cluster">
<title>
cluster
</title>
<polygon fill="none" stroke="black" points="8,-8 8,-193 285.55,-193 285.55,-8 8,-8"></polygon> <text text-anchor="middle" x="146.78" y="-176.4" font-family="Times,serif" font-size="14.00">DAG Flow</text> </g> <!-- DAG_A --> <g id="node1" class="node">
<title>
DAG_A
</title>
<polygon fill="none" stroke="black" points="79.66,-133 15.78,-133 15.78,-97 79.66,-97 79.66,-133"></polygon> <text text-anchor="middle" x="47.72" y="-110.8" font-family="Times,serif" font-size="14.00">DAG_A</text> </g> <!-- DAG_B --> <g id="node2" class="node">
<title>
DAG_B
</title>
<polygon fill="none" stroke="black" points="177.95,-160 115.61,-160 115.61,-124 177.95,-124 177.95,-160"></polygon> <text text-anchor="middle" x="146.78" y="-137.8" font-family="Times,serif" font-size="14.00">DAG_B</text> </g> <!-- DAG_A&#45;&gt;DAG_B --> <g id="edge1" class="edge">
<title>
DAG_A-&gt;DAG_B
</title>
<path fill="none" stroke="black" d="M79.7,-123.62C87.91,-125.9 96.9,-128.4 105.53,-130.8"></path> <polygon fill="black" stroke="black" points="104.85,-134.25 115.43,-133.56 106.73,-127.5 104.85,-134.25"></polygon> </g> <!-- DAG_C --> <g id="node3" class="node">
<title>
DAG_C
</title>
<polygon fill="none" stroke="black" points="177.95,-106 115.61,-106 115.61,-70 177.95,-70 177.95,-106"></polygon> <text text-anchor="middle" x="146.78" y="-83.8" font-family="Times,serif" font-size="14.00">DAG_C</text> </g> <!-- DAG_A&#45;&gt;DAG_C --> <g id="edge2" class="edge">
<title>
DAG_A-&gt;DAG_C
</title>
<path fill="none" stroke="black" d="M79.7,-106.38C87.91,-104.1 96.9,-101.6 105.53,-99.2"></path> <polygon fill="black" stroke="black" points="106.73,-102.5 115.43,-96.44 104.85,-95.75 106.73,-102.5"></polygon> </g> <!-- DAG_D --> <g id="node4" class="node">
<title>
DAG_D
</title>
<polygon fill="none" stroke="black" points="79.66,-79 15.78,-79 15.78,-43 79.66,-43 79.66,-79"></polygon> <text text-anchor="middle" x="47.72" y="-56.8" font-family="Times,serif" font-size="14.00">DAG_D</text> </g> <!-- DAG_D&#45;&gt;DAG_C --> <g id="edge3" class="edge">
<title>
DAG_D-&gt;DAG_C
</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M79.7,-69.62C87.91,-71.9 96.9,-74.4 105.53,-76.8"></path> <polygon fill="black" stroke="black" points="104.85,-80.25 115.43,-79.56 106.73,-73.5 104.85,-80.25"></polygon> </g> <!-- DAG_E --> <g id="node5" class="node">
<title>
DAG_E
</title>
<polygon fill="none" stroke="black" points="177.66,-52 115.89,-52 115.89,-16 177.66,-16 177.66,-52"></polygon> <text text-anchor="middle" x="146.78" y="-29.8" font-family="Times,serif" font-size="14.00">DAG_E</text> </g> <!-- DAG_D&#45;&gt;DAG_E --> <g id="edge4" class="edge">
<title>
DAG_D-&gt;DAG_E
</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M79.7,-52.38C88.08,-50.05 97.27,-47.49 106.06,-45.05"></path> <polygon fill="black" stroke="black" points="107.06,-48.4 115.76,-42.35 105.18,-41.66 107.06,-48.4"></polygon> </g> <!-- DAG_G --> <g id="node6" class="node">
<title>
DAG_G
</title>
<polygon fill="none" stroke="black" points="277.77,-52 213.89,-52 213.89,-16 277.77,-16 277.77,-52"></polygon> <text text-anchor="middle" x="245.83" y="-29.8" font-family="Times,serif" font-size="14.00">DAG_G</text> </g> <!-- DAG_E&#45;&gt;DAG_G --> <g id="edge5" class="edge">
<title>
DAG_E-&gt;DAG_G
</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M177.69,-34C185.93,-34 195.03,-34 203.79,-34"></path> <polygon fill="black" stroke="black" points="203.84,-37.5 213.84,-34 203.84,-30.5 203.84,-37.5"></polygon> </g> </g>
</svg>
</div>
</div>
</div>
</div>
<ul>
<li>큐시스템과 같이 Job 수행이 완료된 Task 는 Push 하고 센싱이 필요한 task 은 큐 시스템을 구독하는 방식을 쓴다면 ? (약한 연결)</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 292.11 209.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 205)">
<title>
G
</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-205 288.11,-205 288.11,4 -4,4"></polygon> <g id="clust1" class="cluster">
<title>
cluster
</title>
<polygon fill="none" stroke="black" points="8,-8 8,-193 276.11,-193 276.11,-8 8,-8"></polygon> <text text-anchor="middle" x="142.06" y="-176.4" font-family="Times,serif" font-size="14.00">DAG Flow</text> </g> <!-- DAG_A --> <g id="node1" class="node">
<title>
DAG_A
</title>
<polygon fill="none" stroke="black" points="79.66,-160 15.78,-160 15.78,-124 79.66,-124 79.66,-160"></polygon> <text text-anchor="middle" x="47.72" y="-137.8" font-family="Times,serif" font-size="14.00">DAG_A</text> </g> <!-- Queue --> <g id="node7" class="node">
<title>
Queue
</title>
<path fill="none" stroke="black" d="M169.44,-102.73C169.44,-104.53 157.34,-106 142.44,-106 127.54,-106 115.44,-104.53 115.44,-102.73 115.44,-102.73 115.44,-73.27 115.44,-73.27 115.44,-71.47 127.54,-70 142.44,-70 157.34,-70 169.44,-71.47 169.44,-73.27 169.44,-73.27 169.44,-102.73 169.44,-102.73"></path> <path fill="none" stroke="black" d="M169.44,-102.73C169.44,-100.92 157.34,-99.45 142.44,-99.45 127.54,-99.45 115.44,-100.92 115.44,-102.73"></path> <text text-anchor="middle" x="142.44" y="-83.8" font-family="Times,serif" font-size="14.00">Queue</text> </g> <!-- DAG_A&#45;&gt;Queue --> <g id="edge1" class="edge">
<title>
DAG_A-&gt;Queue
</title>
<path fill="none" stroke="black" d="M79.6,-124.02C88.29,-118.96 97.8,-113.42 106.7,-108.23"></path> <polygon fill="black" stroke="black" points="108.47,-111.25 115.35,-103.2 104.94,-105.21 108.47,-111.25"></polygon> </g> <!-- DAG_B --> <g id="node2" class="node">
<title>
DAG_B
</title>
<polygon fill="none" stroke="black" points="267.95,-52 205.61,-52 205.61,-16 267.95,-16 267.95,-52"></polygon> <text text-anchor="middle" x="236.78" y="-29.8" font-family="Times,serif" font-size="14.00">DAG_B</text> </g> <!-- DAG_C --> <g id="node3" class="node">
<title>
DAG_C
</title>
<polygon fill="none" stroke="black" points="267.95,-106 205.61,-106 205.61,-70 267.95,-70 267.95,-106"></polygon> <text text-anchor="middle" x="236.78" y="-83.8" font-family="Times,serif" font-size="14.00">DAG_C</text> </g> <!-- DAG_D --> <g id="node4" class="node">
<title>
DAG_D
</title>
<polygon fill="none" stroke="black" points="79.66,-106 15.78,-106 15.78,-70 79.66,-70 79.66,-106"></polygon> <text text-anchor="middle" x="47.72" y="-83.8" font-family="Times,serif" font-size="14.00">DAG_D</text> </g> <!-- DAG_D&#45;&gt;Queue --> <g id="edge2" class="edge">
<title>
DAG_D-&gt;Queue
</title>
<path fill="none" stroke="black" d="M79.6,-88C87.83,-88 96.81,-88 105.31,-88"></path> <polygon fill="black" stroke="black" points="105.35,-91.5 115.35,-88 105.35,-84.5 105.35,-91.5"></polygon> </g> <!-- DAG_E --> <g id="node5" class="node">
<title>
DAG_E
</title>
<polygon fill="none" stroke="black" points="267.66,-160 205.89,-160 205.89,-124 267.66,-124 267.66,-160"></polygon> <text text-anchor="middle" x="236.78" y="-137.8" font-family="Times,serif" font-size="14.00">DAG_E</text> </g> <!-- DAG_G --> <g id="node6" class="node">
<title>
DAG_G
</title>
<polygon fill="none" stroke="black" points="79.66,-52 15.78,-52 15.78,-16 79.66,-16 79.66,-52"></polygon> <text text-anchor="middle" x="47.72" y="-29.8" font-family="Times,serif" font-size="14.00">DAG_G</text> </g> <!-- Queue&#45;&gt;DAG_B --> <g id="edge3" class="edge">
<title>
Queue-&gt;DAG_B
</title>
<path fill="none" stroke="black" d="M169.65,-72.67C178.14,-67.71 187.74,-62.09 196.94,-56.71"></path> <polygon fill="black" stroke="black" points="198.72,-59.73 205.59,-51.66 195.19,-53.68 198.72,-59.73"></polygon> </g> <!-- Queue&#45;&gt;DAG_C --> <g id="edge4" class="edge">
<title>
Queue-&gt;DAG_C
</title>
<path fill="none" stroke="black" d="M169.65,-88C177.7,-88 186.75,-88 195.51,-88"></path> <polygon fill="black" stroke="black" points="195.59,-91.5 205.59,-88 195.59,-84.5 195.59,-91.5"></polygon> </g> <!-- Queue&#45;&gt;DAG_E --> <g id="edge5" class="edge">
<title>
Queue-&gt;DAG_E
</title>
<path fill="none" stroke="black" d="M169.65,-103.33C178.14,-108.29 187.74,-113.91 196.94,-119.29"></path> <polygon fill="black" stroke="black" points="195.19,-122.32 205.59,-124.34 198.72,-116.27 195.19,-122.32"></polygon> </g> </g>
</svg>
</div>
</div>
</div>
</div>
<ul>
<li>Produce / Consume 구조를 이용하여 Task 완료를 알리기 위해 특정 키 값으로 Produce 하고 해당 키를 Consume 하는 DAG 을 트리거 스케줄 할 수 있는 기능
<ul>
<li>실제 큐가 있는 것은 아니고 DB 에 Produce / Consume 내역을 기록</li>
</ul></li>
</ul>
</section>
<section id="정리" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="정리"><span class="header-section-number">1.2</span> 정리</h2>
<ul>
<li>Dataset 은 Pub/sub 구조로 DAG 간 의존관계를 주는 방법</li>
<li>Unique 한 String 형태의 Key 값을 부여하여 Dataset Publish</li>
<li>Dataset 을 Consume 하는 DAG 은 스케줄을 별도로 주지 않고 리스트 형태로 구독할 Dataset 요소들을 명시</li>
<li>Dataset에 의해 시작된 DAG 의 Run_id 는 dataset_triggered__{trigger 된 시간 } 으로 표현됨</li>
<li>Airflow 화면 메뉴 중 Datasets 메뉴를 통해 별도로 Dataset 현황 모니터링 가능</li>
<li>N개의 Dataset 을 구독할 때 스케줄링 시점은 ?
<ul>
<li>마지막 수행 이후 N 개의 Dataset 이 모두 재 업데이트되는 시점 <img src="../../../../../images/airflow/dataset_trigger.PNG" class="img-fluid" alt="Trigger using dataset - N개의 dataset 구독"></li>
</ul></li>
</ul>
</section>
</section>
<section id="dag의-default_args-파라미터" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> DAG의 default_args 파라미터</h1>
<section id="dag-의-default_args-파라미터" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="dag-의-default_args-파라미터"><span class="header-section-number">2.1</span> DAG 의 default_args 파라미터</h2>
<ul>
<li>목적: DAG 하위 모든 오퍼레이터에 공통 적용될 파라미터를 입력</li>
<li>어떤 파라미터들이 적용 가능할까?
<ul>
<li>오퍼레이터에 공통 적용할 수 있는 파라미터들</li>
<li>BaseOperator 클래스 생성자가 가지고 있는 파라미터</li>
</ul></li>
<li><a href="https://airflow.apache.org/docs/apache-airflow/stable/_modules/airflow/models/baseoperator.html#BaseOperator">airflow doc</a></li>
<li>Code</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="sourceCode" id="cb1"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>from airflow import DAG</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>from airflow.operators.bash import BashOperator</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>from datetime import timedelta</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>import pendulum</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>from airflow.models import Variable</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>email_str = Variable.get("email_target")</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>email_lst = <span class="co">[</span><span class="ot">email.strip() for email in email_str.split(',')</span><span class="co">]</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>with DAG(</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    dag_id='dags_sla_email_example',</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    start_date=pendulum.datetime(2023, 5, 1, tz='Asia/Seoul'),</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    schedule='*/10 * * * *',</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    catchup=False,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>) as dag:</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="in">    task_1 = BashOperator(</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="in">        task_id='task_1',</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="in">        bash_command='sleep 10m',</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="in">        sla: timedelta(seconds=70), #SLA 설정</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="in">        email: 'sdf@sdfsfd.com'</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="in">    task_2 = BashOperator(</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="in">        task_id='task_2',</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="in">        bash_command='sleep 2m',</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="in">        sla: timedelta(seconds=70), #SLA 설정</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="in">        email: 'sdf@sdfsfd.com'</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>   task_1 &gt;&gt; task_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column" style="width:50%;">
<div class="sourceCode" id="cb2"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>from airflow import DAG</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>from airflow.operators.bash import BashOperator</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>from datetime import timedelta</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>import pendulum</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>from airflow.models import Variable</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>email_str = Variable.get("email_target")</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>email_lst = <span class="co">[</span><span class="ot">email.strip() for email in email_str.split(',')</span><span class="co">]</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>with DAG(</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    dag_id='dags_sla_email_example',</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    start_date=pendulum.datetime(2023, 5, 1, tz='Asia/Seoul'),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    schedule='*/10 * * * *',</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    catchup=False,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    default_args={</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        'sla': timedelta(seconds=70),</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        'email': 'sdf@sdfsfd.com'</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>) as dag:</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="in">    task_1 = BashOperator(</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="in">        task_id='task_1',</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="in">        bash_command='sleep 10m'</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="in">    task_2 = BashOperator(</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="in">        task_id='task_2',</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="in">        bash_command='sleep 2m'</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>   task_1 &gt;&gt; task_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="baseoperator-파라미터-vs-dag-파라미터" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="baseoperator-파라미터-vs-dag-파라미터"><span class="header-section-number">2.2</span> BaseOperator 파라미터 vs Dag 파라미터</h2>
<div class="columns">
<div class="column" style="width:40%;">
<section id="dag-parameter" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="dag-parameter"><span class="header-section-number">2.2.1</span> DAG Parameter</h3>
<ul>
<li>DAG 파라미터는 DAG 단위로 적용될 파라미터</li>
<li>개별 오퍼레이터에 적용되지 않음</li>
<li>DAG 파라미터는 default_args 에 전달하면 안됨</li>
</ul>
</section>
</div><div class="column" style="width:60%;">
<section id="baseoperator-parameter" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="baseoperator-parameter"><span class="header-section-number">2.2.2</span> BaseOperator Parameter</h3>
<ul>
<li>Base 오퍼레이터 파라미터는 개별 Task 단위로 적용될 파라미터.</li>
<li>Task 마다 선언해줄 수 있지만 DAG 하위 모든 오퍼레이터에 적용 필요시 default_args 를 통해 전달 가능</li>
</ul>
</section>
</div>
</div>
<ul>
<li>default_args 에 전달된 파라미터보다 개별 오퍼레이터에 선언된 파라미터가 우선순위를 가짐</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>from airflow import DAG</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>from airflow.operators.bash import BashOperator</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>from datetime import timedelta</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>import pendulum</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>from airflow.models import Variable</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>email_str = Variable.get("email_target")</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>email_lst = <span class="co">[</span><span class="ot">email.strip() for email in email_str.split(',')</span><span class="co">]</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>with DAG(</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    dag_id='dags_sla_email_example',</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    start_date=pendulum.datetime(2023, 5, 1, tz='Asia/Seoul'),</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    schedule='*/10 * * * *',</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    catchup=False,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    default_args={</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        'sla': timedelta(seconds=70),</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        'email': 'sdf@sdfsfd.com'</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>) as dag:</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="in">    task_1 = BashOperator(</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="in">        task_id='task_1',</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="in">        bash_command='sleep 10m'</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="in">    task_2 = BashOperator(</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="in">        task_id='task_2',</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="in">        bash_command='sleep 2m',</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="in">        sla=timedelta(minutes=1)</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>   task_1 &gt;&gt; task_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="task-실패시-email-발송하기" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Task 실패시 Email 발송하기</h1>
<section id="email-발송-위한-파라미터-확인" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="email-발송-위한-파라미터-확인"><span class="header-section-number">3.1</span> Email 발송 위한 파라미터 확인</h2>
<ul>
<li><a href="https://airflow.apache.org/docs/apache-airflow/stable/_modules/airflow/models/baseoperator.html#BaseOperator">airflow doc</a></li>
<li>email 파라미터와 email_on_failure 파라미터를 이용</li>
<li>email 파라미터만 입력하면 email_on_failure 파라미터는 True 로 자동설정됨</li>
</ul>
</section>
<section id="email-발송-대상-등록" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="email-발송-대상-등록"><span class="header-section-number">3.2</span> Email 발송 대상 등록</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>from airflow import DAG</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>from airflow.operators.bash import BashOperator</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>from airflow.decorators import task</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>from airflow.exceptions import AirflowException</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>import pendulum</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>from datetime import timedelta</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>from airflow.models import Variable</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>email_str = Variable.get("email_target")</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>email_lst = <span class="co">[</span><span class="ot">email.strip() for email in email_str.split(',')</span><span class="co">]</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>with DAG(</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    dag_id='dags_email_on_failure',</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    start_date=pendulum.datetime(2023,5,1, tz='Asia/Seoul'),</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    catchup=False,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    schedule='0 1 * * *',</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    dagrun_timeout=timedelta(minutes=2),</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    default_args={</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        'email_on_failure': True,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        'email': email_lst</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>) as dag:</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    @task(task_id='python_fail')</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    def python_task_func():</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        raise AirflowException('에러 발생')</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    python_task_func()</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="in">    bash_fail = BashOperator(</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="in">        task_id='bash_fail',</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="in">        bash_command='exit 1',</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="in">    bash_success = BashOperator(</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="in">        task_id='bash_success',</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="in">        bash_command='exit 0',</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Email 받을 대상이 1 명이면 string 형식으로 , 2 명 이상이면 list 로 전달</li>
<li>그런데 협업 환경에서 DAG 담당자는 수시로 바뀔 수 있고 인원도 수시로 바뀔 수 있는데 그때마다 DAG 을 뒤져서 email 리스트를 수정해야 할까 ?</li>
<li>이럴때 Variable 을 이용하자</li>
</ul>
</section>
</section>
<section id="sla로-task-수행-감시-email-발송하기" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> SLA로 task 수행 감시 &amp; Email 발송하기</h1>
<section id="sla파라미터-이해" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="sla파라미터-이해"><span class="header-section-number">4.1</span> SLA파라미터 이해</h2>
<ul>
<li>개념: 오퍼레이터 수행시 정해놓은 시간을 초과하였는지를 판단할 수 있도록 설정해놓은 시간 값 파이썬의 timedelta 로 정의</li>
<li>동작: 설정해놓은 SLA 를 초과하여 오퍼레이터 running 시 SLA Miss 발생 , Airflow UI 화면에서 Miss 건만 조회 가능 + email 발송 가능
<ul>
<li>SLA Miss 발생시 task 가 실패되는 것은 아니며 단순 Miss 대상에 기록만 됨</li>
<li>SLA 는 DAG 파라미터가 아니며 BaseOperator 의 파라미터</li>
</ul></li>
<li><a href="https://airflow.apache.org/docs/apache-airflow/stable/_modules/airflow/models/baseoperator.html#BaseOperator">airflow docs</a></li>
<li><a href="https://airflow.apache.org/docs/apache-airflow/stable/_modules/airflow/models/dag.html">SLA Miss시 수행할 함수 지정 가능-Source code for airflow.models.dag</a>
<ul>
<li>sla_miss_callback 파라미터</li>
<li>DAG의 파라미터임 (BaseOperator 의 파라미터가 아니라는 것에 유의)</li>
</ul></li>
</ul>
</section>
<section id="sla-제약사항" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="sla-제약사항"><span class="header-section-number">4.2</span> SLA 제약사항</h2>
<ul>
<li>각 Task 의 SLA timeout 카운트 시작은 DAG 의 시작시간 기준임</li>
</ul>
<div class="columns">
<div class="column" style="width:40%;">
<section id="생각하는-sla-timeout-카운트-방식" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="생각하는-sla-timeout-카운트-방식"><span class="header-section-number">4.2.1</span> 생각하는 SLA timeout 카운트 방식</h3>
<p><img src="../../../../../images/airflow/SLA_timeout_count1.PNG" class="img-fluid"></p>
</section>
</div><div class="column" style="width:60%;">
<section id="실제-airflow-의-sla-timeout-카운트-방식" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="실제-airflow-의-sla-timeout-카운트-방식"><span class="header-section-number">4.2.2</span> 실제 Airflow 의 SLA timeout 카운트 방식</h3>
<p><img src="../../../../../images/airflow/SLA_timeout_count2.PNG" class="img-fluid"></p>
</section>
</div>
</div>
<ul>
<li>DAG의 시작시간 기준 → 명목적인 시작 시간 (data_interval_start)
<ul>
<li>만약 Pool 이 부족하거나 스케줄러의 부하로 인해 DAG 이 스케줄보다 늦게 시작했다면 늦게 시작한만큼 SLA 시간 카운트는 소요됨</li>
<li>실질적 DAG 시작 시간을 기준으로 카운트하지 않음</li>
</ul></li>
<li>첫 스케줄에서는 SLA Miss 가 기록되지 않음 (두 번째 스케줄부터 기록)</li>
</ul>
</section>
<section id="sla-miss-시-email-발송하기" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="sla-miss-시-email-발송하기"><span class="header-section-number">4.3</span> SLA Miss 시 email 발송하기</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>from airflow import DAG</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>from airflow.operators.bash import BashOperator</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>from datetime import timedelta</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>import pendulum</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>from airflow.models import Variable</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>email_str = Variable.get("email_target")</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>email_lst = <span class="co">[</span><span class="ot">email.strip() for email in email_str.split(',')</span><span class="co">]</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>with DAG(</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    dag_id='dags_sla_email_example',</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    start_date=pendulum.datetime(2023, 5, 1, tz='Asia/Seoul'),</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    schedule='*/10 * * * *',</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    catchup=False,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    default_args={</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        'sla': timedelta(seconds=70),</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        'email': email_lst</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>) as dag:</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="in">    task_slp_30s_sla_70s = BashOperator(</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="in">        task_id='task_slp_30s_sla_70s',</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="in">        bash_command='sleep 30'</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="in">    task_slp_60_sla_70s = BashOperator(</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="in">        task_id='task_slp_60_sla_70s',</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="in">        bash_command='sleep 60'</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="in">    task_slp_10s_sla_70s = BashOperator(</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="in">        task_id='task_slp_10s_sla_70s',</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="in">        bash_command='sleep 10'</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="in">    task_slp_10s_sla_30s = BashOperator(</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="in">        task_id='task_slp_10s_sla_30s',</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="in">        bash_command='sleep 10',</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="in">        sla=timedelta(seconds=30)</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="in">    task_slp_30s_sla_70s &gt;&gt; task_slp_60_sla_70s &gt;&gt; task_slp_10s_sla_70s &gt;&gt; task_slp_10s_sla_30s</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="timeout-설정하기" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> timeout 설정하기</h1>
<section id="timeout-파라미터-이해" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="timeout-파라미터-이해"><span class="header-section-number">5.1</span> Timeout 파라미터 이해</h2>
<ul>
<li>Task수준의 timeout 과 DAG 수준의 timeout 이 존재</li>
<li><a href="https://airflow.apache.org/docs/apache-airflow/stable/_modules/airflow/models/baseoperator.html#BaseOperator">Task수준의 timeout 파라미터</a> : execution_timeout</li>
<li><a href="https://airflow.apache.org/docs/apache-airflow/stable/_modules/airflow/models/dag.html">DAG수준의 timeout 파라미터</a> : dagrun_timeout</li>
<li>task1 &gt;&gt; task2 &gt;&gt; task3 예시</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<section id="execution_timeout" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="execution_timeout"><span class="header-section-number">5.1.1</span> execution_timeout</h3>
<p><img src="../../../../../images/airflow/execution_timeout1.PNG" class="img-fluid"></p>
</section>
</div><div class="column" style="width:50%;">
<section id="datgrun_timeout" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="datgrun_timeout"><span class="header-section-number">5.1.2</span> datgrun_timeout</h3>
<p><img src="../../../../../images/airflow/dagrun_timeout.PNG" class="img-fluid"></p>
</section>
</div>
</div>
</section>
<section id="정리-1" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="정리-1"><span class="header-section-number">5.2</span> 정리</h2>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Comparision</th>
<th>sla</th>
<th>execution_timeout</th>
<th>dagrun_timeout</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>파라미터 정의 위치</td>
<td>BaseOperator</td>
<td>BaseOperator</td>
<td>DAG</td>
</tr>
<tr class="even">
<td>적용 수준</td>
<td>Task</td>
<td>task</td>
<td>DAG</td>
</tr>
<tr class="odd">
<td>기능</td>
<td>지정한 시간 초과시 Miss 기록</td>
<td>지정한 시간 초과시 task fail 처리</td>
<td>지정한 시간 초과시 DAG fail 처리</td>
</tr>
<tr class="even">
<td>email 발송 가능 여부</td>
<td>O</td>
<td>O</td>
<td>X</td>
</tr>
<tr class="odd">
<td>timeout 발생시 후행 task 상태</td>
<td>상관없이 지속</td>
<td>Upstream_failed</td>
<td>Skipped (current) /No status (not run)</td>
</tr>
<tr class="even">
<td>스케쥴 필요</td>
<td>O</td>
<td>X</td>
<td>X</td>
</tr>
</tbody>
</table>
<ul>
<li>공통점: 파이썬의 timedelta 함수로 timeout 기준 시간 정의</li>
</ul>
</section>
</section>
<section id="airflow-cli-사용하기" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Airflow CLI 사용하기</h1>
<ul>
<li>Airflow가 설치되어 있는 서버에서 쉘 명령을 이용하여 Airflow를 컨트롤 할 수 있도록 많은 기능들을 제공하고 있음</li>
<li><a href="https://airflow.apache.org/docs/apache-airflow/stable/cli-and-env-variables-ref.html">airflow cli doc</a></li>
<li>Cli를 잘 쓰면 좋은 이유
<ul>
<li>일괄작업: Airflow UI에서 할 수 없는 일괄 작업 방식을 제공(ex: connection 일괄 등록)</li>
<li>특수기능: Airflow UI에서는 할 수 없는 기능을 제공(ex: backfill)</li>
<li>자동화: Airflow UI에서 직접 눈으로 보고 클릭하는 방식이 아닌 프로그래밍에 의한 제어가 가능해짐</li>
</ul></li>
</ul>
<section id="cli---dag-trigger" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="cli---dag-trigger"><span class="header-section-number">6.1</span> cli - dag trigger</h2>
<ul>
<li><p>manual 로 dag trigger 하거나 run_id 를 직접 넣어 trigger 할 수 있는 기능</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../.././../../images/airflow/cli_dag_trigger.PNG" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">CLI-Dag Trigger</figcaption>
</figure>
</div>
<ul>
<li><code>#&gt; airflow dags trigger dags_seoul_api_corona</code></li>
</ul></li>
</ul>
</section>
<section id="cli---dag-backfill" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="cli---dag-backfill"><span class="header-section-number">6.2</span> cli - dag backfill</h2>
<ul>
<li>입력 스케줄 구간에 대해 일괄 (재)실행 (스케줄 이력이 없는 과거 날짜도 가능) <img src="../../.././../../images/airflow/cli_dag_balckfill.PNG" class="img-fluid" alt="CLI-Dag backfill"></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>#&gt; airflow dags backfill -s 2023-04-19 -e 2023-04-21 dags_seoul_api_corona</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu"># start, end 파라미터를 dash string 형태로 입력하면 UTC로 간주되며 타임스탬프 형태로 직접 작성도 가능 (run_id에서 해당하는 날짜 구간을 찾아 실행)</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>#&gt; airflow dags backfill -s 2023-04-19T22:00:00+00:00 -e 2023-04-20T22:00:00+00:00 —</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>reset-dagruns dags_seoul_api_corona</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="cli---task-clear" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="cli---task-clear"><span class="header-section-number">6.3</span> cli - task clear</h2>
<ul>
<li>Clear 작업을 start / end 구간으로 일괄 재실행</li>
<li>Backfill과 달리 수행되지 않은 스케줄 구간은 실행할 수 없음 <img src="../../../../../images/airflow/cli_task_cleaner.PNG" class="img-fluid" alt="CLI-Task Clear"></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>#&gt; airflow tasks clear -s 2023-05-07 -e 2023-05-12 dags_seoul_api_corona</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>#&gt; airflow tasks clear -s 2023-05-07T22:00:00+00:00 -e 2023-05-12T22:00:00+00:00</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>dags_seoul_api_corona</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Backfill되었던 DAG은 clear 불가함. reset-dagruns 옵션과 함께 다시 Backfill 수행해야 함</li>
</ul>
</section>
<section id="정리-2" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="정리-2"><span class="header-section-number">6.4</span> 정리</h2>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Comparision</th>
<th>trigger</th>
<th>backfill</th>
<th>clear</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>목적</td>
<td>특정 날짜로 DAG Trigger</td>
<td>Start ~ end 구간의 스케줄 실행</td>
<td>Start ~ end 구간 내 이미 수</td>
</tr>
<tr class="even">
<td>행되었던 스케줄 재실행</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Run type</td>
<td>-r 옵션으로 지정 가능. 없으면 Manual</td>
<td>Backfill</td>
<td>원래의 run_type</td>
</tr>
<tr class="even">
<td>기 수행된 run_id가 존재하는 경우</td>
<td>동일 run_id 가 존재하는 경우 에러 발생</td>
<td>Run_type 을 Backfill 로 덮어쓰며</td>
<td></td>
</tr>
<tr class="odd">
<td>재실행</td>
<td>재실행</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>구간 지정</td>
<td>불가</td>
<td>가능</td>
<td>가능</td>
</tr>
<tr class="odd">
<td>과거 날짜 적용 가능</td>
<td>가능</td>
<td>가능</td>
<td>불가</td>
</tr>
<tr class="even">
<td>task 선택 가능</td>
<td>불가</td>
<td>가능</td>
<td>가능</td>
</tr>
</tbody>
</table>
<ul>
<li>공통점: CLI 명령으로 DAG 실행 가능</li>
</ul>
</section>
</section>
</div>
<div id="English" class="tab-pane fade" role="tabpanel" aria-labelledby="English-tab">

</div>
<section id="go-to-blog-content-list" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Go to Blog Content List</h1>
<p><a href="../../../../../docs/blog/posts/content_list.html">Blog Content List</a></p>


</section>

</div></ul></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="./docs/comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>